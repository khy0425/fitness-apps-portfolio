# Task ID: 20
# Title: Challenge Mode Implementation
# Status: done
# Dependencies: 7, 10
# Priority: low
# Description: Implement additional challenge modes as specified in the PRD
# Details:
1. Create a ChallengeService class
2. Implement the following challenge modes:
   - 7-day consecutive workout challenge
   - 50 push-ups in one go challenge
   - 200 push-ups challenge (after completing 100)
3. Add challenge tracking and progress
4. Implement challenge rewards and achievements
5. Add challenge-specific UI elements

Example implementation:
```dart
class ChallengeService {
  Future<List<Challenge>> getAvailableChallenges(UserProfile profile) async {
    // Determine which challenges are available based on user progress
    // Return list of available challenges
  }
  
  Future<void> startChallenge(int challengeId) async {
    // Initialize challenge tracking
    // Update user profile
  }
  
  Future<void> updateChallengeProgress(int challengeId, int progress) async {
    // Update challenge progress
    // Check for completion
  }
}
```

# Test Strategy:
Test challenge availability logic. Verify challenge progress tracking and completion detection. Test challenge rewards and achievements.

# Subtasks:
## 1. Create Challenge Model and Data Structures [done]
### Dependencies: None
### Description: Define the Challenge model class and related data structures to represent different challenge types, progress tracking, and completion status.
### Details:
Create a Challenge class with properties like id, title, description, type (enum for different challenge types), targetValue (e.g., 7 days, 50 push-ups), currentProgress, startDate, completionDate, isCompleted, and reward information. Include enums for challenge types and difficulty levels. Implement serialization/deserialization methods for database storage.
<info added on 2025-05-28T07:56:29.271Z>
Challenge model class and data structure completed:

- Created Challenge model class in lib/models/challenge.dart
- Implemented enums: ChallengeType (consecutiveDays, singleSession, cumulative), ChallengeDifficulty (easy, medium, hard, extreme), and ChallengeStatus (available, active, completed, failed, locked)
- Created ChallengeReward class for the reward system
- Implemented complete data serialization/deserialization (toMap/fromMap)
- Added useful getter methods (progressPercentage, isCompleted, remainingProgress, etc.)
- Implemented extension methods (displayName, emoji, etc.)

Key features implemented:
- Progress calculation and status management
- Prerequisites system
- Reward system
- Metadata support
- Date tracking (start date, completion date, last update)
- Estimated time calculation
</info added on 2025-05-28T07:56:29.271Z>

## 2. Implement ChallengeService Class [done]
### Dependencies: 20.1
### Description: Create the ChallengeService class with core functionality for managing challenges including fetching available challenges, starting challenges, and updating progress.
### Details:
Implement the ChallengeService with methods for getAvailableChallenges(), startChallenge(), updateChallengeProgress(), completeChallenge(), and abandonChallenge(). Include logic to determine challenge availability based on user progress (e.g., 200 push-ups challenge only available after completing 100 push-ups challenge). Connect to the database service for persistence.
<info added on 2025-05-28T08:00:08.439Z>
ChallengeService class implementation completed:

âœ… Completed work:
- Created ChallengeService class (lib/services/challenge_service.dart)
- Defined 5 basic challenges (7 consecutive days, 50 at once, 100 cumulative, 200 cumulative, 14 consecutive days)
- Implemented challenge state management (available, active, completed, failed, locked)
- Implemented prerequisites system
- Integrated reward system (badges, points, special features)

ğŸ”§ Core functionality implemented:
- getAvailableChallenges(): Query available challenges
- startChallenge(): Start a challenge
- updateChallengeProgress(): Update progress
- _completeChallenge(): Process challenge completion
- abandonChallenge(): Abandon a challenge
- Special logic for each challenge type (consecutive days, single session, cumulative)
- Data persistence through SharedPreferences
- Integration with existing AchievementService and NotificationService

ğŸ¯ Logic by challenge type:
- Consecutive days: Fails if a day is missed, progress increases daily
- Single session: Achieve goal in one session
- Cumulative: Achieve goal across multiple sessions
</info added on 2025-05-28T08:00:08.439Z>

## 3. Implement Specific Challenge Types [done]
### Dependencies: 20.2
### Description: Implement the three specific challenge types with their unique tracking and completion logic.
### Details:
Extend the ChallengeService to handle the specific logic for each challenge type: 1) 7-day consecutive workout (track daily completion and reset on missed days), 2) 50 push-ups in one go (track max push-ups in a single session), 3) 200 push-ups challenge (track cumulative push-ups and verify prerequisite completion). Each challenge type should have custom validation and progress tracking logic.
<info added on 2025-05-28T08:10:31.428Z>
Implemented specific logic for each challenge type:

âœ… Completed implementations:
- updateChallengesOnWorkoutComplete method to update challenges when workouts are completed
- _updateConsecutiveDaysChallenge special logic for consecutive day challenges
- getSingleSessionBestRecord to retrieve best records for single-session challenges
- getCumulativeProgress to check progress on cumulative challenges
- getConsecutiveDaysProgress to track streaks for consecutive day challenges
- failChallenge functionality to handle challenge failures
- restartChallenge capability to reset challenges
- getTodayChallengesSummary to provide daily challenge status overview
- getChallengeHint to offer tips and guidance for each challenge

ğŸ”§ Core functionalities:
- Consecutive days: Date-based progress tracking with automatic failure on missed days
- Single session: Best record tracking with immediate completion upon goal achievement
- Cumulative: Progress management across multiple sessions
- Automatic failure handling and restart mechanisms
- Methods for seamless integration with workout screens

ğŸ¯ Special features:
- Today's workout completion tracking
- Customized hints for each challenge type
- Automatic transition to restart-ready state upon failure
- Challenge-specific progress calculation algorithms

Next step: Implement UI for challenge progress tracking
</info added on 2025-05-28T08:10:31.428Z>

## 4. Create Challenge UI Components [done]
### Dependencies: 20.1, 20.2
### Description: Develop UI components for displaying challenges, progress tracking, and interaction.
### Details:
Create widgets for: 1) ChallengeListView to display available challenges, 2) ChallengeDetailView for viewing and starting a specific challenge, 3) ChallengeProgressWidget for visualizing progress (e.g., progress bars, streak calendars), 4) ChallengeCompletionDialog for celebrating completed challenges. Ensure consistent styling with the rest of the app and implement responsive layouts.
<info added on 2025-05-28T08:17:50.489Z>
ì±Œë¦°ì§€ UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ ì™„ë£Œ:

âœ… ì™„ë£Œëœ ì‘ì—…:
- ChallengeScreen ë©”ì¸ í™”ë©´ êµ¬í˜„ (3ê°œ íƒ­: ì‚¬ìš© ê°€ëŠ¥, ì§„í–‰ ì¤‘, ì™„ë£Œ)
- ChallengeCard ìœ„ì ¯ êµ¬í˜„ (ì±Œë¦°ì§€ ì •ë³´ ì¹´ë“œ)
- ChallengeProgressWidget êµ¬í˜„ (ì±Œë¦°ì§€ íƒ€ì…ë³„ ì§„í–‰ ìƒí™© í‘œì‹œ)
- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ì— ì±Œë¦°ì§€ ë©”ë‰´ ì¶”ê°€
- ìš´ë™ í™”ë©´ê³¼ ì±Œë¦°ì§€ ì‹œìŠ¤í…œ í†µí•©

ğŸ”§ êµ¬í˜„ëœ UI ì»´í¬ë„ŒíŠ¸:
- ì±Œë¦°ì§€ ì¹´ë“œ: ì œëª©, ì„¤ëª…, ë‚œì´ë„, ìƒíƒœ, ì§„í–‰ë¥ , ë³´ìƒ ì •ë³´ í‘œì‹œ
- ì§„í–‰ ìƒí™© ìœ„ì ¯: ì—°ì†ì¼ìˆ˜/ë‹¨ì¼ì„¸ì…˜/ëˆ„ì  íƒ€ì…ë³„ íŠ¹í™”ëœ UI
- íƒ­ ê¸°ë°˜ ë„¤ë¹„ê²Œì´ì…˜: ì‚¬ìš© ê°€ëŠ¥/ì§„í–‰ ì¤‘/ì™„ë£Œëœ ì±Œë¦°ì§€ ë¶„ë¥˜
- ë°˜ì‘í˜• ë””ìì¸: ë‹¤ì–‘í•œ í™”ë©´ í¬ê¸° ì§€ì›
- ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œ: ì‹œì‘/í¬ê¸° ë²„íŠ¼, ìƒˆë¡œê³ ì¹¨, ìƒíƒœ í‘œì‹œ

ğŸ¨ UI/UX íŠ¹ì§•:
- ì±Œë¦°ì§€ íƒ€ì…ë³„ ìƒ‰ìƒ êµ¬ë¶„ (íŒŒë€ìƒ‰/ì£¼í™©ìƒ‰/ì´ˆë¡ìƒ‰)
- ë‚œì´ë„ë³„ ì‹œê°ì  í‘œì‹œ (ì´ëª¨ì§€ + ìƒ‰ìƒ)
- ì§„í–‰ë¥  ë°” ë° í¼ì„¼í‹°ì§€ í‘œì‹œ
- íŒíŠ¸ ë° íŒ ì œê³µ
- ë³´ìƒ ì •ë³´ ì‹œê°í™”
- ì™„ë£Œ ë‚ ì§œ í‘œì‹œ

ğŸ”— ì‹œìŠ¤í…œ í†µí•©:
- ìš´ë™ ì™„ë£Œ ì‹œ ìë™ ì±Œë¦°ì§€ ì—…ë°ì´íŠ¸
- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì— ì±Œë¦°ì§€ ë©”ë‰´ ì¶”ê°€
- ê¸°ì¡´ ì„œë¹„ìŠ¤ë“¤ê³¼ ì™„ë²½í•œ ì—°ë™
</info added on 2025-05-28T08:17:50.489Z>

## 5. Implement Challenge Rewards and Achievement Integration [done]
### Dependencies: 20.2, 20.3
### Description: Connect challenge completion to the rewards and achievements system, providing users with incentives for completing challenges.
### Details:
Extend ChallengeService to trigger reward distribution and achievement unlocks upon challenge completion. Implement methods to grant in-app currency, unlock special features, or award badges based on challenge difficulty. Create notifications for achievement unlocks. Update user profile with completed challenges and earned rewards. Ensure proper integration with existing achievement and reward systems.
<info added on 2025-05-28T08:21:17.174Z>
ì±Œë¦°ì§€ ë³´ìƒ ë° ì—…ì  ì‹œìŠ¤í…œ í†µí•© ì™„ë£Œ:

âœ… ì™„ë£Œëœ ì‘ì—…:
- AchievementTypeì— challenge íƒ€ì… ì¶”ê°€
- 6ê°œì˜ ì±Œë¦°ì§€ ê´€ë ¨ ì—…ì  ì¶”ê°€:
  * challenge_7_days: 7ì¼ ì—°ì† ì±Œë¦°ì§€ ì™„ë£Œ (ë ˆì–´, 500 XP)
  * challenge_50_single: 50ê°œ í•œë²ˆì— ì±Œë¦°ì§€ ì™„ë£Œ (ì—í”½, 750 XP)
  * challenge_100_cumulative: 100ê°œ ëˆ„ì  ì±Œë¦°ì§€ ì™„ë£Œ (ë ˆì–´, 400 XP)
  * challenge_200_cumulative: 200ê°œ ëˆ„ì  ì±Œë¦°ì§€ ì™„ë£Œ (ì—í”½, 800 XP)
  * challenge_14_days: 14ì¼ ì—°ì† ì±Œë¦°ì§€ ì™„ë£Œ (ë ˆì „ë”ë¦¬, 1200 XP)
  * challenge_master: ëª¨ë“  ì±Œë¦°ì§€ ì™„ë£Œ (ë ˆì „ë”ë¦¬, 2000 XP)

ğŸ”§ êµ¬í˜„ëœ í†µí•© ê¸°ëŠ¥:
- AchievementServiceì— _checkChallengeAchievements ë©”ì„œë“œ ì¶”ê°€
- markChallengeCompleted ë©”ì„œë“œë¡œ ì±Œë¦°ì§€ ì™„ë£Œ ì‹œ ì—…ì  ìë™ ì²´í¬
- ChallengeServiceì˜ _grantRewardsì— ì—…ì  ì‹œìŠ¤í…œ í†µí•©
- SharedPreferencesë¥¼ í†µí•œ ì±Œë¦°ì§€ ì™„ë£Œ ìƒíƒœ ì˜ì†í™”
- ì±Œë¦°ì§€ ì™„ë£Œ ì‹œ ìë™ ì—…ì  í•´ì œ ë° ì•Œë¦¼

ğŸ¯ ë³´ìƒ ì‹œìŠ¤í…œ:
- ì±Œë¦°ì§€ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ê´€ë ¨ ì—…ì  í•´ì œ
- ê²½í—˜ì¹˜ ë³´ìƒ (400-2000 XP)
- ë°°ì§€ ë° íŠ¹ë³„ ê¸°ëŠ¥ í•´ê¸ˆ
- ì•Œë¦¼ ì‹œìŠ¤í…œì„ í†µí•œ ì¦‰ì‹œ í”¼ë“œë°±
- ì±Œë¦°ì§€ ë§ˆìŠ¤í„° ì—…ì ìœ¼ë¡œ ëª¨ë“  ì±Œë¦°ì§€ ì™„ë£Œ ì¸ì„¼í‹°ë¸Œ ì œê³µ

ğŸ”— ì™„ì „í•œ ì‹œìŠ¤í…œ í†µí•©:
- ìš´ë™ ì™„ë£Œ â†’ ì±Œë¦°ì§€ ì§„í–‰ â†’ ì—…ì  í•´ì œ â†’ ì•Œë¦¼ í‘œì‹œ
- ê¸°ì¡´ ì—…ì  ì‹œìŠ¤í…œê³¼ ì™„ë²½í•œ í˜¸í™˜ì„±
- íƒ€ì… ì•ˆì „ì„± í™•ë³´ ë° linter ì˜¤ë¥˜ í•´ê²°
</info added on 2025-05-28T08:21:17.174Z>

